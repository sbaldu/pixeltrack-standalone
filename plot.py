import numpy as np
import matplotlib.pyplot as plt
from matplotlib import colors
import pandas as pd
import os
import mplhep as hep

def truncate_colormap(cmap, minval=0.0, maxval=1.0, n=100):
    new_cmap = colors.LinearSegmentedColormap.from_list(
        'trunc({n},{a:.2f},{b:.2f})'.format(n=cmap.name, a=minval, b=maxval),
        cmap(np.linspace(minval, maxval, n)))
    return new_cmap

plt.style.use(hep.style.CMS) #1
plt.rcParams['figure.facecolor'] = 'white' #2
hep.cms.text('Preliminary') #3

df = pd.read_csv('optimization/checkpoint/pareto_front.csv')

fitnesses = {}
for i in range(50):
    df_i = pd.read_csv(f'optimization/history/iteration{i}.csv')
    fitnesses[i] = df_i.iloc[:, -2:].values

# CAThetaCutBarrel,CAThetaCutForward,dcaCutInnerTriplet,dcaCutOuterTriplet,hardCurvCut,doZ0Cut,phiCut_0,phiCut_1,phiCut_2,phiCut_3,phiCut_4,phiCut_5,phiCut_6,phiCut_7,phiCut_8,phiCut_9,phiCut_10,phiCut_11,phiCut_12,phiCut_13,phiCut_14,phiCut_15,phiCut_16,phiCut_17,phiCut_18,phiCut_19,phiCut_20,1-efficiency,fake_rate
# 0.000916893925645307,0.004231107193311521,0.054560810146192004,0.776241643026465478,0.397322235212903052,0.000000000000000000,587.000000000000000000,734.000000000000000000,525.000000000000000000,712.000000000000000000,650.000000000000000000,520.000000000000000000,569.000000000000000000,704.000000000000000000,643.000000000000000000,1000.000000000000000000,600.000000000000000000,442.000000000000000000,664.000000000000000000,519.000000000000000000,646.000000000000000000,574.000000000000000000,435.000000000000000000,622.000000000000000000,620.000000000000000000,477.000000000000000000,453.000000000000000000,0.393379000000000034,0.006724610000000000
# 0.000506968042233258,0.000000000000000000,0.000937999328584519,1.000000000000000000,0.292397660818713434,1.000000000000000000,866.000000000000000000,400.000000000000000000,406.000000000000000000,400.000000000000000000,425.000000000000000000,400.000000000000000000,1000.000000000000000000,400.000000000000000000,400.000000000000000000,999.000000000000000000,400.000000000000000000,400.000000000000000000,400.000000000000000000,400.000000000000000000,400.000000000000000000,1000.000000000000000000,400.000000000000000000,400.000000000000000000,1000.000000000000000000,400.000000000000000000,400.000000000000000000,0.990385960000000010,0.000853971000000000
# 0.000771395570468552,0.000823832943832866,0.021381192690023018,1.000000000000000000,0.292397660818713434,1.000000000000000000,732.000000000000000000,527.000000000000000000,437.000000000000000000,401.000000000000000000,542.000000000000000000,400.000000000000000000,867.000000000000000000,481.000000000000000000,450.000000000000000000,1000.000000000000000000,429.000000000000000000,400.000000000000000000,439.000000000000000000,400.000000000000000000,457.000000000000000000,1000.000000000000000000,400.000000000000000000,400.000000000000000000,974.000000000000000000,438.000000000000000000,400.000000000000000000,0.481736999999999971,0.003021940000000000

pf_params = df.iloc[:, :-2].values
pf_fitnesses = df.iloc[:, -2:].values

param_names = df.columns[:-2].tolist()
objective_names = df.columns[-2:].tolist()

default_eff = 0.43711
default_fake = 0.0214034


cb_red = '#e42536'
cb_blue = '#5790fc'
cb_grey = '#9c9ca1'
cb_purple = '#7a21dd'
cb_orange = '#f89c20'

new_cmap = truncate_colormap(plt.get_cmap('Blues'), 0, 1)


for i in range(50):
    plt.scatter(fitnesses[i][:,1], 1-fitnesses[i][:,0], color=cb_blue, alpha=(i+1)/50, edgecolors='none', s=28)
plt.scatter(pf_fitnesses[:,1], 1-pf_fitnesses[:,0], color=cb_red, label='Pareto Front', s=28)
plt.scatter(default_fake, 1-default_eff, color=cb_orange, label='Default', marker='X',s=100)

plt.xlim(0, 0.025)
plt.legend()

plt.savefig('optimization/pareto_front.png')
plt.savefig('optimization/pareto_front.pdf')

